<!DOCTYPE html>
<html >
<head>
    <title >Chat Bot</title>
    <style>
        body{
            font-family: Arial;
        }
        .send-button{
            background-color : green;
            color: white;
            padding: 12px 20px;
            margin-left: 10px;
            font-size: 15px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
        }

        .input-box{
            border-width: 1px;
            border-radius: 10px;
            font-size: 15px;
            padding: 12px 20px;
            flex-grow: 1;
            margin-bottom: 10px;
            justify-content: center;
        }

        .app-container{
            flex: grow;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .chat-input-user{
            display: flex;
            justify-content: end;
            align-items: start;
        }

        .chat-input-robot{
            display: flex;
            justify-content: start;
            align-items: start;
        }

        .chat-message-text{
            background-color: rgb(196, 196, 196);
            border-radius: 10px;
            margin-left: 5px;
            margin-right: 5px;
            margin-top: 5px;
            padding: 12px 20px;
            max-width: 300px;

        }
    </style>
</head>
<body>
<div class="js-container"> </div>
    <script src="https://unpkg.com/supersimpledev/react.js"> </script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"> </script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"> </script>
    <script src="https://unpkg.com/supersimpledev/babel.js"> </script>
    <script type="text/babel">

        function ChatMessage({message, sender}) {
            return (
                <div className={
                        sender=='user' 
                        ? 'chat-input-user'
                        : 'chat-input-robot'
                    }> 
                    {sender == 'robot' && 
                    (<img src="./public/robot.png" width="40px" />)
                    }
                    <div className='chat-message-text'>
                        {message} 
                    </ div>
                    {sender == 'user' && 
                    (<img src="./public/user.png" width="40px" />)
                    }
                </div>
            );
        }

        function ChatInput({chatMessages, setChatMessages}) {
            const [inputText, setInputText] = React.useState("");
            function handleChange(event){
                setInputText(event.target.value);
            }

            function sendMessage(){
                const newChatMessages = [...chatMessages, {
                    message: inputText,
                    sender: "user",
                    id: crypto.randomUUID()
                }];
                setChatMessages(newChatMessages);

                const response = Chatbot.getResponse(inputText);
                setChatMessages([...newChatMessages, {
                    message: response,
                    sender: "robot",
                    id: crypto.randomUUID()
                }]);
            }

            return (
            <>
            <input  onChange = {handleChange} 
                    value={inputText}
                    placeholder="Type your message..." 
                    size = '30'
                    className = "input-box"/>
            <button onClick = {sendMessage} className = 'send-button'>
                Send
            </button>
            </>
            );
        }

        function ChatMessages({chatMessages}) {

            const chatMessagesRef = React.useRef(null);
            React.useEffect(()=>{
                const containerElem = chatMessagesRef.current;
                if (containerElem){
                containerElem.scrollTop = containerElem.scrollHeight;
            }
            }, [chatMessages]);
            return (
        <div className = 'chat-messages-container' ref = {chatMessagesRef}>
            {chatMessages.map((chatMessage) => {
                    return (
                        <ChatMessage 
                            message={chatMessage.message} 
                            sender={chatMessage.sender} 
                            key={chatMessage.id}
                        />
                    );
                })
            }
            </div>);
        }


        function App() {
            const [chatMessages, setChatMessages] = React.useState([
                {message: "Hello! How can I assist you today?", sender: 'robot' , id : 'id1'},
                {message: "Flip a coin", sender: 'user', id : 'id2'},
                {message: "You got heads", sender: 'robot', id : 'id3'},
                {message: "What is React?", sender: 'user', id : 'id4'},
            ]);

            return (
                <div className = "app-container">
                    <ChatInput 
                        chatMessages = {chatMessages}
                        setChatMessages = {setChatMessages}
                    />
                    <ChatMessages chatMessages = {chatMessages} />
                </div>
            );
        }
      
        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>
</html>