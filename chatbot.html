<!DOCTYPE html>
<html >
<head>
    <title >Chat Bot</title>
</head>
<body>
<div class="js-container"> </div>
    <script src="https://unpkg.com/supersimpledev/react.js"> </script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"> </script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"> </script>
    <script src="https://unpkg.com/supersimpledev/babel.js"> </script>
    <script type="text/babel">

        function ChatMessage({message, sender}) {
            return (
                <div> 
                    {sender == 'robot' && 
                    (<img src="./public/robot.png" width="40px" />)
                    }
                    {message} 
                    {sender == 'user' && 
                    (<img src="./public/user.png" width="40px" />)
                    }
                </div>
            );
        }

        function ChatInput({chatMessages, setChatMessages}) {
            const [inputText, setInputText] = React.useState("");
            function handleChange(event){
                setInputText(event.target.value);
            }

            function sendMessage(){
                const newChatMessages = [...chatMessages, {
                    message: inputText,
                    sender: "user",
                    id: crypto.randomUUID()
                }];
                setChatMessages(newChatMessages);

                const response = Chatbot.getResponse(inputText);
                setChatMessages([...newChatMessages, {
                    message: response,
                    sender: "robot",
                    id: crypto.randomUUID()
                }]);
            }

            return (
            <>
            <input  onChange = {handleChange} 
                    value={inputText}
                    placeholder="Type your message..." 
                    size = '30'/>
            <button onClick = {sendMessage}>
                Send
            </button>
            </>
            );
        }

        function ChatMessages({chatMessages}) {
            return (
            <>
            {chatMessages.map((chatMessage) => {
                    return (
                        <ChatMessage 
                            message={chatMessage.message} 
                            sender={chatMessage.sender} 
                            key={chatMessage.id}
                        />
                    );
                })
            }
            </>);
        }


        function App() {
            const [chatMessages, setChatMessages] = React.useState([
                {message: "Hello! How can I assist you today?", sender: 'robot' , id : 'id1'},
                {message: "Flip a coin", sender: 'user', id : 'id2'},
                {message: "You got heads", sender: 'robot', id : 'id3'},
                {message: "What is React?", sender: 'user', id : 'id4'},
            ]);

            return (
                <>
                    <ChatInput 
                        chatMessages = {chatMessages}
                        setChatMessages = {setChatMessages}
                    />
                    <ChatMessages chatMessages = {chatMessages} />
                </>
            );
        }
      
        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>
</html>